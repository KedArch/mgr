---
- name: "Modify inventory host variables"
  ansible.builtin.import_playbook: _modify_inventory_host.yml

- name: SSH Port Forwarding with tmux
  hosts: localhost
  tasks:
    - name: Start a new tmux session for SSH port forwarding # noqa: no-changed-when ignore-errors
      vars:
        node_ip: "{{ hostvars[first_cp_node]['ansible_host'] }}"
      ansible.builtin.command: >
        tmux new-session -d -s ssh_forwarding
        "ssh -N -L 6443:{{ node_ip }}:6443 -L 8500:{{ node_ip }}:8500 -L 4646:{{ node_ip }}:4646
        {{ hostvars['host']['ansible_user'] }}@{{ hostvars['host']['ansible_host'] }}"
      ignore_errors: true
